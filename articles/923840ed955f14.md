---
title: "è‡ªå®…ã®ã‚µãƒ¼ãƒãƒ¼ã® ssh ã¨ code-server ã« Cloudflare for Teams ã§å®‰å…¨ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹"
emoji: "ğŸ‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["ssh", "code-server", "cloudflare", "vscode"]
published: true
---

è‡ªå®…ã‚µãƒ¼ãƒãƒ¼ã§ç¨¼åƒã—ã¦ã„ã‚‹ ssh ã¨ code-server ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã€ Cloudflrad for Teams ã‚’åˆ©ç”¨ã—ã¦ã¿ã¾ã—ãŸã€‚ãƒãƒ¼ãƒˆé–‹æ”¾ä¸è¦ã§ Google èªè¨¼ã‚’åˆ©ç”¨ã—ã¦å®‰å…¨ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

cloudflared ã‚’åˆ©ç”¨ã—ã¦ã€ãƒˆãƒ³ãƒãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/installation)ã«ã‚ã‚‹é€šã‚Šã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```sh
wget -q https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
dpkg -i cloudflared-linux-amd64.deb
```

è¨­å®šã¯[ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://developers.cloudflare.com/cloudflare-one/tutorials/ssh)ã‚’å‚è€ƒã«å®Ÿæ–½ã—ã¾ã™ã€‚

æœ€åˆã«ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ãƒˆãƒ³ãƒãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```sh
cloudflared tunnel login
cloudflared tunnel create example
```

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§å¿…è¦ã¨ãªã‚‹ ID ã‚’ç¢ºèªã—ã¾ã™ã€‚

```sh
cloudflared tunnel list
```

tunnel ã¨ credentials-file ã® ID ã®éƒ¨åˆ†ã‚’ç¢ºèªã—ãŸçµæœã«ç½®ãæ›ãˆã¾ã™ã€‚

```yaml
# ~/.cloudflared/config.yml
tunnel: 6ff42ae2-765d-4adf-8112-31c55c1551ef
credentials-file: /root/.cloudflared/6ff42ae2-765d-4adf-8112-31c55c1551ef.json

ingress:
  - hostname: ssh.example.com
    service: ssh://localhost:22
  - hostname: code-server.example.com
    service: http://localhost:8080
  - service: http_status:404
```

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¼‰ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã®CNAMEã‚’ä»¥ä¸‹ã®æ§˜ã«è¨­å®šã—ã¾ã™ã€‚

```txt
6ff42ae2-765d-4adf-8112-31c55c1551ef.cfargotunnel.com
```

ãƒˆãƒ³ãƒãƒ«ã‚’é–‹å§‹ã™ã‚‹ã¨ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```sh
cloudflared tunnel run example
```

ãƒ‡ãƒ¼ãƒ¢ãƒ³ã¨ã—ã¦ç¨¼åƒã•ã›ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ systemd ã§ç¨¼åƒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```sh
sudo cloudflared --config /home/example/.cloudflared/config.yml service install
```
